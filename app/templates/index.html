<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CFA Practice</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <!-- Top Row: Filters -->
  <header class="top-bar">
    <form id="filter-form" method="get" action="/">
      <label for="level">Level:</label>
      <select name="level" id="level">
        <option value="">All</option>
        <option value="I">Level I</option>
        <option value="II">Level II</option>
        <option value="III">Level III</option>
      </select>

      <label for="topic">Topic:</label>
      <select name="topic" id="topic">
        <option value="">All</option>
        <option value="Ethics">Ethics</option>
        <option value="Quantitative Methods">Quantitative Methods</option>
        <option value="Economics">Economics</option>
        <option value="Financial Reporting">Financial Reporting</option>
        <option value="Corporate Finance">Corporate Finance</option>
        <option value="Equity">Equity</option>
        <option value="Fixed Income">Fixed Income</option>
        <option value="Derivatives">Derivatives</option>
        <option value="Alternative Investments">Alternative Investments</option>
        <option value="Portfolio Management">Portfolio Management</option>
      </select>

      <button type="submit">Apply</button>
      <button type="button" id="next-btn">Next Question</button>
    </form>
  </header>

  <div class="container">

    <!-- Left Column: Ads -->
    <aside class="ads">
      <h3>Advertisement</h3>
      <div class="ad-box">Ad space</div>
    </aside>

    <!-- Center Column: Question -->
    <main class="quiz">
      <h2>{{ question.question }}</h2>
      <ul>
        {% for choice in question.choices %}
          <li>
            <button onclick="showAnswer('{{ loop.index0 | tojson | safe }}')">{{ choice }}</button>
          </li>
        {% endfor %}
      </ul>
      <div id="timer">30</div>
    </main>

    <!-- Right Column: Answer/Explanation -->
    <aside class="explanation">
      <h3>Explanation</h3>
      <p id="explanation-text" style="display:none;">{{ question.explanation }}</p>
    </aside>

  </div>

  <script>
  const correctAnswer = {{ question.answer | default(None) | tojson | safe }};
    function showAnswer(selected) {
      const explanation = document.getElementById("explanation-text");
      if (selected === correctAnswer) {
        explanation.innerHTML = "✅ Correct! " + explanation.innerHTML;
      } else {
        explanation.innerHTML = "❌ Wrong. " + explanation.innerHTML;
      }
      explanation.style.display = "block";
    }

    // Timer
    let time = 30;
    const timerElement = document.getElementById("timer");
    const timer = setInterval(() => {
      time--;
      timerElement.innerText = time;
      if (time <= 0) clearInterval(timer);
    }, 1000);

    // "Next Question" reload
    document.getElementById("next-btn").addEventListener("click", () => {
      window.location.reload();
    });
  </script>
</body>
</html>
